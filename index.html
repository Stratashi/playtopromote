<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Play to Promote - Win Games, Get Traffic</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: linear-gradient(135deg, #0f0c29, #302b63, #24243e); color: #fff; min-height: 100vh; }
        .header { background: rgba(0,0,0,0.5); padding: 20px; border-bottom: 2px solid #00d4ff; position: sticky; top: 0; z-index: 100; }
        .header-content { max-width: 1200px; margin: 0 auto; display: flex; justify-content: space-between; align-items: center; }
        .logo { font-size: 1.8em; color: #00d4ff; font-weight: bold; }
        .session-info { display: flex; gap: 20px; align-items: center; }
        .session-info button { background: #ff4444; color: #fff; border: none; padding: 8px 15px; border-radius: 5px; cursor: pointer; font-weight: bold; }
        .container { max-width: 1200px; margin: 0 auto; padding: 40px 20px; }
        .page { display: none; }
        .page.active { display: block; }
        .hero { text-align: center; padding: 80px 20px; background: linear-gradient(180deg, rgba(0,212,255,0.1), transparent); }
        h1 { font-size: 2.8em; margin-bottom: 20px; background: linear-gradient(45deg, #00d4ff, #8a2be2); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; }
        .hero p { font-size: 1.2em; color: #ccc; margin-bottom: 40px; }
        .hero-stats { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; max-width: 600px; margin: 0 auto 40px; }
        .stat-item { background: rgba(0,212,255,0.1); padding: 20px; border-radius: 10px; }
        .stat-number { display: block; font-size: 2em; font-weight: bold; color: #00d4ff; }
        .stat-label { display: block; font-size: 0.9em; margin-top: 10px; color: #999; }
        .cta-btn { background: linear-gradient(45deg, #00d4ff, #0099cc); color: #000; border: none; padding: 15px 40px; font-size: 1.1em; border-radius: 8px; cursor: pointer; font-weight: bold; transition: all 0.3s; }
        .cta-btn:hover { transform: scale(1.05); }
        .section { padding: 60px 20px; border-bottom: 1px solid rgba(0,212,255,0.1); }
        .section h2 { font-size: 2.2em; margin-bottom: 40px; text-align: center; }
        .form-container { background: rgba(30,30,50,0.9); padding: 40px; border-radius: 10px; max-width: 500px; margin: 0 auto; }
        .form-group { margin-bottom: 25px; }
        .form-group label { display: block; margin-bottom: 8px; color: #00d4ff; font-weight: bold; }
        .form-group input { width: 100%; padding: 12px; border: 1px solid #00d4ff; background: rgba(0,0,0,0.3); color: #fff; border-radius: 5px; font-size: 1em; }
        .form-group input:focus { outline: none; border-color: #8a2be2; box-shadow: 0 0 10px rgba(0,212,255,0.3); }
        .submit-btn { width: 100%; padding: 12px; background: linear-gradient(45deg, #8a2be2, #5a0a92); color: #fff; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; font-size: 1.1em; }
        .features-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 30px; }
        .feature-card { background: rgba(30,30,50,0.6); padding: 30px; border-radius: 10px; text-align: center; }
        .feature-icon { font-size: 3em; margin-bottom: 15px; }
        .testimonials { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; }
        .testimonial { background: rgba(30,30,50,0.6); padding: 20px; border-left: 3px solid #00d4ff; border-radius: 5px; }
        .testimonial-author { display: block; margin-top: 15px; color: #00d4ff; font-weight: bold; }
        .lobby-container { max-width: 1200px; margin: 0 auto; }
        .lobby-actions { display: flex; gap: 10px; margin-bottom: 30px; justify-content: center; flex-wrap: wrap; }
        .btn-primary { background: linear-gradient(45deg, #00d4ff, #0099cc); color: #000; border: none; padding: 12px 25px; border-radius: 8px; cursor: pointer; font-weight: bold; transition: all 0.3s; }
        .btn-primary:hover { transform: translateY(-2px); }
        .btn-secondary { background: linear-gradient(45deg, #8a2be2, #5a0a92); color: #fff; border: none; padding: 12px 25px; border-radius: 8px; cursor: pointer; font-weight: bold; transition: all 0.3s; }
        .btn-secondary:hover { transform: translateY(-2px); }
        .rooms-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 20px; margin-top: 30px; }
        .room-card { background: rgba(30,30,50,0.8); border: 2px solid #00d4ff; padding: 25px; border-radius: 10px; }
        .room-card h3 { color: #00d4ff; margin-bottom: 15px; }
        .room-card p { margin: 8px 0; color: #999; }
        .dashboard-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px; margin-bottom: 30px; }
        .dash-stat { background: rgba(30,30,50,0.8); padding: 25px; border-radius: 10px; text-align: center; }
        .dash-value { font-size: 2.5em; font-weight: bold; color: #00d4ff; margin-bottom: 8px; }
        .dash-label { color: #999; }
        .loading { text-align: center; padding: 40px; color: #999; }
        @media (max-width: 768px) {
            h1 { font-size: 2em; }
            .hero-stats { grid-template-columns: 1fr; }
            .features-grid { grid-template-columns: 1fr; }
            .testimonials { grid-template-columns: 1fr; }
            .dashboard-grid { grid-template-columns: repeat(2, 1fr); }
        }
    </style>
</head>
<body>
    <!-- HEADER -->
    <div class="header">
        <div class="header-content">
            <div class="logo">üéÆ Play to Promote</div>
            <div class="session-info">
                <span id="session-user" style="display:none;">üë§ <strong id="session-name"></strong></span>
                <span id="session-credits" style="display:none;">üí∞ <span id="session-credits-val">0</span></span>
                <button id="logout-btn" onclick="logout()" style="display:none;">Logout</button>
            </div>
        </div>
    </div>

    <!-- LANDING PAGE -->
    <div id="landing-page" class="page active">
        <section class="hero">
            <h1>Win Games. Get Traffic. Grow Your Brand.</h1>
            <p>Join 5,000+ creators using PlayToPromote to drive clicks and build their audience through competitive multiplayer gaming.</p>
            <div class="hero-stats">
                <div class="stat-item">
                    <span class="stat-number">7+</span>
                    <span class="stat-label">Average clicks per win</span>
                </div>
                <div class="stat-item">
                    <span class="stat-number">100%</span>
                    <span class="stat-label">Real players, zero bots</span>
                </div>
                <div class="stat-item">
                    <span class="stat-number">3-5min</span>
                    <span class="stat-label">Fast-paced games</span>
                </div>
            </div>
            <button class="cta-btn" onclick="document.getElementById('registration-section').scrollIntoView({behavior:'smooth'})">Get Started Now ‚Üí</button>
        </section>

        <section id="registration-section" class="section">
            <h2>Start Playing in 30 Seconds</h2>
            <div class="form-container">
                <form onsubmit="handleRegistration(event)">
                    <div class="form-group">
                        <label>Username (3-20 characters)</label>
                        <input type="text" id="username" placeholder="Your gaming handle" required minlength="3" maxlength="20">
                    </div>
                    <div class="form-group">
                        <label>Your Promo Link</label>
                        <input type="url" id="promo-link" placeholder="https://your-link.com" required>
                    </div>
                    <button type="submit" class="submit-btn">Create Profile & Play Now</button>
                </form>
            </div>
        </section>

        <section class="section">
            <h2>How It Works</h2>
            <div class="features-grid">
                <div class="feature-card">
                    <div class="feature-icon">‚öîÔ∏è</div>
                    <h3>Battle Other Creators</h3>
                    <p>Play fast 3-5 minute competitive games against real players from around the world.</p>
                </div>
                <div class="feature-card">
                    <div class="feature-icon">üèÜ</div>
                    <h3>Win to Promote</h3>
                    <p>Winners get all player visits. Every victory drives traffic directly to your link.</p>
                </div>
                <div class="feature-card">
                    <div class="feature-icon">üìä</div>
                    <h3>Track Your Growth</h3>
                    <p>Real-time analytics show exactly how many clicks you're getting from each game.</p>
                </div>
            </div>
        </section>

        <section class="section">
            <h2>Creator Success Stories</h2>
            <div class="testimonials">
                <div class="testimonial">
                    <p>"Got 200 new readers in my first week! PlayToPromote is a game changer."</p>
                    <span class="testimonial-author">- Alex, Comic Creator</span>
                </div>
                <div class="testimonial">
                    <p>"My Twitch followers grew 300% using this platform. Highly recommend!"</p>
                    <span class="testimonial-author">- Jordan, Content Creator</span>
                </div>
                <div class="testimonial">
                    <p>"Best cross-promotion tool for creators. I'm making real money from the traffic."</p>
                    <span class="testimonial-author">- Taylor, YouTuber</span>
                </div>
            </div>
        </section>
    </div>

    <!-- MULTIPLAYER LOBBY PAGE -->
    <div id="lobby-page" class="page">
        <div class="container">
            <div class="lobby-container">
                <h2 style="margin-bottom: 30px;">üéÆ Multiplayer Lobby</h2>
                <div class="lobby-actions">
                    <button class="btn-primary" onclick="createRoom()">+ Create New Room</button>
                    <button class="btn-secondary" onclick="refreshRooms()">üîÑ Refresh</button>
                    <button class="btn-secondary" onclick="showDashboard()">üìä Dashboard</button>
                </div>
                <div id="rooms-list" class="rooms-grid">
                    <div class="loading">Loading available rooms...</div>
                </div>
            </div>
        </div>
    </div>

    <!-- DASHBOARD PAGE -->
    <div id="dashboard-page" class="page">
        <div class="container">
            <h2 style="margin-bottom: 30px;">Your Stats & Profile</h2>
            <div class="dashboard-grid">
                <div class="dash-stat">
                    <div class="dash-value" id="dash-wins">0</div>
                    <div class="dash-label">Wins</div>
                </div>
                <div class="dash-stat">
                    <div class="dash-value" id="dash-score">0</div>
                    <div class="dash-label">Total Score</div>
                </div>
                <div class="dash-stat">
                    <div class="dash-value" id="dash-credits">0</div>
                    <div class="dash-label">Credits</div>
                </div>
                <div class="dash-stat">
                    <div class="dash-value" style="font-size: 1.2em; word-break: break-all;" id="dash-link"></div>
                    <div class="dash-label">Your Promo Link</div>
                </div>
            </div>
            <button class="btn-primary" onclick="showLobby()" style="margin-top: 20px;">‚Üê Back to Lobby</button>
        </div>
    </div>

    <!-- FIREBASE SCRIPTS FIRST -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js"></script>

    <!-- MAIN APP LOGIC (LAST) -->
    <script>
        // Firebase Config
        const firebaseConfig = {
            apiKey: "AIzaSyBX0lxB7NZVMZftkB-T1jp9PfqNkQQHtXg",
            authDomain: "playtopromote.firebaseapp.com",
            projectId: "playtopromote",
            storageBucket: "playtopromote.firebasestorage.app",
            messagingSenderId: "947196888409",
            appId: "1:947196888409:web:7c3792b6fe34b238a17848"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        // Global State
        let currentUser = null;
        let currentUsername = "";
        let currentLink = "";
        let userStats = { wins: 0, score: 0, credits: 0 };
        let roomsListener = null;

        // Initialize on load
        window.addEventListener('DOMContentLoaded', () => {
            const saved = localStorage.getItem('ptpSession');
            if (saved) {
                const ses = JSON.parse(saved);
                currentUser = ses.uid;
                currentUsername = ses.username;
                currentLink = ses.link;
                userStats = ses.stats || userStats;
                showSessionUI();
                showLobby();
            }
        });

        function saveSession() {
            localStorage.setItem('ptpSession', JSON.stringify({
                uid: currentUser,
                username: currentUsername,
                link: currentLink,
                stats: userStats
            }));
        }

        function showSessionUI() {
            document.getElementById('session-user').style.display = 'inline';
            document.getElementById('session-name').textContent = currentUsername;
            document.getElementById('session-credits').style.display = 'inline';
            document.getElementById('session-credits-val').textContent = userStats.credits;
            document.getElementById('logout-btn').style.display = 'block';
        }

        function hideSessionUI() {
            document.getElementById('session-user').style.display = 'none';
            document.getElementById('session-credits').style.display = 'none';
            document.getElementById('logout-btn').style.display = 'none';
        }

        function showPage(pageId) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById(pageId).classList.add('active');
        }

        function showLanding() {
            showPage('landing-page');
            hideSessionUI();
        }

        function showLobby() {
            showPage('lobby-page');
            loadRooms();
        }

        function showDashboard() {
            showPage('dashboard-page');
            document.getElementById('dash-wins').textContent = userStats.wins;
            document.getElementById('dash-score').textContent = userStats.score;
            document.getElementById('dash-credits').textContent = userStats.credits;
            document.getElementById('dash-link').textContent = currentLink;
        }

        async function handleRegistration(e) {
            e.preventDefault();
            const username = document.getElementById('username').value;
            const link = document.getElementById('promo-link').value;

            try {
                const result = await auth.signInAnonymously();
                currentUser = result.user.uid;
                currentUsername = username;
                currentLink = link;

                await db.collection('users').doc(currentUser).set({
                    username: username,
                    link: link,
                    uid: currentUser,
                    wins: 0,
                    score: 0,
                    credits: 0,
                    createdAt: new Date()
                });

                saveSession();
                showSessionUI();
                showLobby();
            } catch (error) {
                alert('Error: ' + error.message);
            }
        }

        async function createRoom() {
            try {
                const roomId = Math.random().toString(36).substr(2, 9);
                await db.collection('rooms').doc(roomId).set({
                    roomId: roomId,
                    host: currentUser,
                    hostName: currentUsername,
                    status: 'waiting',
                    players: [{ uid: currentUser, username: currentUsername, link: currentLink }],
                    createdAt: new Date(),
                    maxPlayers: 4
                });
                alert('‚úÖ Room created! Other players can join now.');
                loadRooms();
            } catch (error) {
                alert('Error: ' + error.message);
            }
        }

        async function loadRooms() {
            const roomsList = document.getElementById('rooms-list');
            roomsList.innerHTML = '<div class="loading">Loading rooms...</div>';

            try {
                if (roomsListener) roomsListener();

                roomsListener = db.collection('rooms')
                    .where('status', '==', 'waiting')
                    .orderBy('createdAt', 'desc')
                    .limit(20)
                    .onSnapshot(snapshot => {
                        roomsList.innerHTML = '';
                        if (snapshot.empty) {
                            roomsList.innerHTML = '<div class="loading">No active rooms. Create one!</div>';
                            return;
                        }

                        snapshot.forEach(doc => {
                            const room = doc.data();
                            const roomCard = document.createElement('div');
                            roomCard.className = 'room-card';
                            roomCard.innerHTML = `
                                <h3>${room.hostName}'s Room</h3>
                                <p>üë• Players: ${room.players.length}/${room.maxPlayers}</p>
                                <p>‚è±Ô∏è Status: ${room.status}</p>
                                <button class="btn-primary" onclick="joinRoom('${doc.id}')" style="width:100%; margin-top:15px;">Join Game</button>
                            `;
                            roomsList.appendChild(roomCard);
                        });
                    });
            } catch (error) {
                console.error('Error:', error);
                roomsList.innerHTML = '<div class="loading">Error loading rooms</div>';
            }
        }

        async function joinRoom(roomId) {
            try {
                const roomRef = db.collection('rooms').doc(roomId);
                const roomSnap = await roomRef.get();

                if (!roomSnap.exists) {
                    alert('Room not found');
                    loadRooms();
                    return;
                }

                const room = roomSnap.data();
                if (room.players.length >= room.maxPlayers) {
                    alert('Room is full');
                    return;
                }

                const playerExists = room.players.some(p => p.uid === currentUser);
                if (!playerExists) {
                    room.players.push({ uid: currentUser, username: currentUsername, link: currentLink });
                    await roomRef.update({ players: room.players });
                }

                alert(`‚úÖ Joined ${room.hostName}'s room! Game starting soon...`);
            } catch (error) {
                alert('Error: ' + error.message);
            }
        }

        function refreshRooms() {
            loadRooms();
        }

        function logout() {
            localStorage.removeItem('ptpSession');
            currentUser = null;
            currentUsername = "";
            currentLink = "";
            userStats = { wins: 0, score: 0, credits: 0 };
            if (roomsListener) roomsListener();
            showLanding();
        }
    </script>
</body>
</html>