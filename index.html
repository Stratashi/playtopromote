<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Play to Promote - Win Games, Get Traffic</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js"></script>
</head>
<body>
    <!-- HEADER WITH LOGO & SESSION INFO -->
    <header class="header-bar">
        <div class="header-content">
            <h2 class="logo">üéÆ Play to Promote</h2>
            <div class="session-info">
                <span id="session-user" style="display:none;">üë§ <strong id="session-name"></strong></span>
                <button id="logout-btn" onclick="logout()" style="display:none;">Logout</button>
                <span id="session-credits" style="display:none;">üí∞ <span id="session-credits-val">0</span></span>
            </div>
        </div>
    </header>

    <!-- LANDING PAGE (Hero + Registration) -->
    <div id="landing-page" class="page active">
        <!-- Hero Section -->
        <section class="hero">
            <div class="hero-content">
                <h1>Win Games. Get Traffic. Grow Your Brand.</h1>
                <p>Join 5,000+ creators using PlayToPromote to drive clicks and build their audience through competitive multiplayer gaming.</p>
                <div class="hero-stats">
                    <div class="stat-item">
                        <span class="stat-number">7+</span>
                        <span class="stat-label">Average clicks per win</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-number">100%</span>
                        <span class="stat-label">Real players, zero bots</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-number">3-5min</span>
                        <span class="stat-label">Fast-paced games</span>
                    </div>
                </div>
                <button class="cta-button" onclick="scrollToRegistration()">Get Started Now ‚Üí</button>
            </div>
        </section>

        <!-- Registration Section -->
        <section id="registration-section" class="section registration-section">
            <h2>Start Playing in 30 Seconds</h2>
            <form id="registration-form" onsubmit="handleRegistration(event)" class="registration-form">
                <div class="form-group">
                    <label for="username">Username (3-20 characters)</label>
                    <input type="text" id="username" placeholder="Your gaming handle" required minlength="3" maxlength="20">
                </div>
                <div class="form-group">
                    <label for="promo-link">Your Promo Link</label>
                    <input type="url" id="promo-link" placeholder="https://your-link.com" required>
                </div>
                <button type="submit" class="submit-button">Create Profile & Play Now</button>
            </form>
        </section>

        <!-- Features Section -->
        <section class="section features-section">
            <h2>How It Works</h2>
            <div class="features-grid">
                <div class="feature-card">
                    <div class="feature-icon">‚öîÔ∏è</div>
                    <h3>Battle Other Creators</h3>
                    <p>Play fast 3-5 minute competitive games against real players from around the world.</p>
                </div>
                <div class="feature-card">
                    <div class="feature-icon">üèÜ</div>
                    <h3>Win to Promote</h3>
                    <p>Winners get all player visits. Every victory drives traffic directly to your link.</p>
                </div>
                <div class="feature-card">
                    <div class="feature-icon">üìä</div>
                    <h3>Track Your Growth</h3>
                    <p>Real-time analytics show exactly how many clicks you're getting from each game.</p>
                </div>
            </div>
        </section>

        <!-- Testimonials Section -->
        <section class="section testimonials-section">
            <h2>Creator Success Stories</h2>
            <div class="testimonials">
                <div class="testimonial">
                    <p>"Got 200 new readers in my first week! PlayToPromote is a game changer."</p>
                    <span class="testimonial-author">- Alex, Comic Creator</span>
                </div>
                <div class="testimonial">
                    <p>"My Twitch followers grew 300% using this platform. Highly recommend!"</p>
                    <span class="testimonial-author">- Jordan, Content Creator</span>
                </div>
                <div class="testimonial">
                    <p>"Best cross-promotion tool for creators. I'm making real money from the traffic."</p>
                    <span class="testimonial-author">- Taylor, YouTuber</span>
                </div>
            </div>
        </section>
    </div>

    <!-- MULTIPLAYER LOBBY PAGE -->
    <div id="lobby-page" class="page">
        <div class="lobby-container">
            <h2>Available Game Rooms</h2>
            <div class="lobby-actions">
                <button class="btn-primary" onclick="createRoom()">+ Create New Room</button>
                <button class="btn-secondary" onclick="refreshRooms()">üîÑ Refresh Rooms</button>
                <button class="btn-secondary" onclick="showDashboard()">üìä My Dashboard</button>
            </div>

            <div id="rooms-list" class="rooms-grid">
                <div class="loading">Loading available rooms...</div>
            </div>
        </div>
    </div>

    <!-- DASHBOARD PAGE -->
    <div id="dashboard-page" class="page">
        <div class="dashboard-container">
            <h2>Your Stats & Profile</h2>
            <div class="dashboard-grid">
                <div class="stat-card">
                    <div class="stat-value" id="dash-wins">0</div>
                    <div class="stat-label">Wins</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="dash-score">0</div>
                    <div class="stat-label">Total Score</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="dash-credits">0</div>
                    <div class="stat-label">Credits</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="dash-link"></div>
                    <div class="stat-label">Your Promo Link</div>
                </div>
            </div>
            <button class="btn-primary" onclick="showLobby()">‚Üê Back to Lobby</button>
        </div>
    </div>

    <!-- GAME PAGE (Canvas) -->
    <div id="game-page" class="page">
        <canvas id="gameCanvas" width="800" height="600"></canvas>
        <canvas id="miniMapCanvas" width="150" height="150"></canvas>
        <div id="game-hud"></div>
    </div>

    <!-- MAIN APP JS (merged from app.js with multiplayer) -->
    <script>
        // Firebase Config
        const firebaseConfig = {
            apiKey: "AIzaSyBX0lxB7NZVMZftkB-T1jp9PfqNkQQHtXg",
            authDomain: "playtopromote.firebaseapp.com",
            projectId: "playtopromote",
            storageBucket: "playtopromote.firebasestorage.app",
            messagingSenderId: "947196888409",
            appId: "1:947196888409:web:7c3792b6fe34b238a17848"
        };

        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        // Global State
        let currentUser = null;
        let currentUsername = "";
        let currentLink = "";
        let userStats = { wins: 0, score: 0, credits: 0 };
        let roomsListener = null;

        // ============ SESSION MANAGEMENT ============
        function saveSession() {
            localStorage.setItem('ptpSession', JSON.stringify({
                uid: currentUser,
                username: currentUsername,
                link: currentLink,
                stats: userStats
            }));
        }

        function restoreSession() {
            const saved = localStorage.getItem('ptpSession');
            if (saved) {
                const ses = JSON.parse(saved);
                currentUser = ses.uid;
                currentUsername = ses.username;
                currentLink = ses.link;
                userStats = ses.stats || userStats;
                showSessionUI();
                showLobby();
            }
        }

        function showSessionUI() {
            document.getElementById('session-user').style.display = 'inline';
            document.getElementById('session-name').textContent = currentUsername;
            document.getElementById('session-credits').style.display = 'inline';
            document.getElementById('session-credits-val').textContent = userStats.credits;
            document.getElementById('logout-btn').style.display = 'block';
        }

        function logout() {
            localStorage.removeItem('ptpSession');
            currentUser = null;
            currentUsername = "";
            currentLink = "";
            userStats = { wins: 0, score: 0, credits: 0 };
            document.getElementById('session-user').style.display = 'none';
            document.getElementById('session-credits').style.display = 'none';
            document.getElementById('logout-btn').style.display = 'none';
            showLandingPage();
        }

        // ============ PAGE NAVIGATION ============
        function showPage(pageId) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById(pageId).classList.add('active');
        }

        function showLandingPage() {
            showPage('landing-page');
        }

        function showLobby() {
            showPage('lobby-page');
            loadRooms();
        }

        function showDashboard() {
            showPage('dashboard-page');
            document.getElementById('dash-wins').textContent = userStats.wins;
            document.getElementById('dash-score').textContent = userStats.score;
            document.getElementById('dash-credits').textContent = userStats.credits;
            document.getElementById('dash-link').textContent = currentLink;
        }

        function scrollToRegistration() {
            document.getElementById('registration-section').scrollIntoView({ behavior: 'smooth' });
        }

        // ============ REGISTRATION ============
        async function handleRegistration(e) {
            e.preventDefault();
            const username = document.getElementById('username').value;
            const link = document.getElementById('promo-link').value;

            try {
                const result = await auth.signInAnonymously();
                currentUser = result.user.uid;
                currentUsername = username;
                currentLink = link;

                // Save to Firestore
                await db.collection('users').doc(currentUser).set({
                    username: username,
                    link: link,
                    uid: currentUser,
                    wins: 0,
                    score: 0,
                    credits: 0,
                    createdAt: new Date()
                });

                saveSession();
                showSessionUI();
                showLobby();
            } catch (error) {
                alert('Error: ' + error.message);
            }
        }

        // ============ MULTIPLAYER ROOMS ============
        async function createRoom() {
            try {
                const roomId = Math.random().toString(36).substr(2, 9);
                await db.collection('rooms').doc(roomId).set({
                    roomId: roomId,
                    host: currentUser,
                    hostName: currentUsername,
                    status: 'waiting',
                    players: [{
                        uid: currentUser,
                        username: currentUsername,
                        link: currentLink
                    }],
                    createdAt: new Date(),
                    maxPlayers: 4
                });
                alert('Room created! Other players can join now.');
                loadRooms();
            } catch (error) {
                alert('Error creating room: ' + error.message);
            }
        }

        async function loadRooms() {
            const roomsList = document.getElementById('rooms-list');
            roomsList.innerHTML = '<div class="loading">Loading rooms...</div>';

            try {
                if (roomsListener) roomsListener();

                roomsListener = db.collection('rooms')
                    .where('status', '==', 'waiting')
                    .orderBy('createdAt', 'desc')
                    .onSnapshot(snapshot => {
                        roomsList.innerHTML = '';
                        if (snapshot.empty) {
                            roomsList.innerHTML = '<div class="no-rooms">No active rooms. Create one!</div>';
                            return;
                        }

                        snapshot.forEach(doc => {
                            const room = doc.data();
                            const roomCard = document.createElement('div');
                            roomCard.className = 'room-card';
                            roomCard.innerHTML = `
                                <h3>${room.hostName}'s Room</h3>
                                <p>Players: ${room.players.length}/${room.maxPlayers}</p>
                                <p>Status: ${room.status}</p>
                                <button class="btn-primary" onclick="joinRoom('${doc.id}')">Join Game</button>
                            `;
                            roomsList.appendChild(roomCard);
                        });
                    }, error => {
                        console.error('Error loading rooms:', error);
                        roomsList.innerHTML = '<div class="error">Error loading rooms. Try again.</div>';
                    });
            } catch (error) {
                console.error('Error:', error);
            }
        }

        async function joinRoom(roomId) {
            try {
                const roomRef = db.collection('rooms').doc(roomId);
                const roomSnap = await roomRef.get();

                if (!roomSnap.exists) {
                    alert('Room not found');
                    loadRooms();
                    return;
                }

                const room = roomSnap.data();
                if (room.players.length >= room.maxPlayers) {
                    alert('Room is full');
                    return;
                }

                const playerExists = room.players.some(p => p.uid === currentUser);
                if (!playerExists) {
                    room.players.push({
                        uid: currentUser,
                        username: currentUsername,
                        link: currentLink
                    });
                    await roomRef.update({ players: room.players });
                }

                alert(`Joined ${room.hostName}'s room! Game starting soon...`);
                // TODO: Start game with this room
            } catch (error) {
                alert('Error joining room: ' + error.message);
            }
        }

        function refreshRooms() {
            loadRooms();
        }

        // ============ INIT ============
        window.addEventListener('DOMContentLoaded', () => {
            restoreSession();
        });
    </script>

    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0f0c29, #302b63, #24243e);
            color: #fff;
            min-height: 100vh;
        }

        .header-bar {
            background: rgba(0, 0, 0, 0.5);
            padding: 15px 20px;
            border-bottom: 2px solid #00d4ff;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-size: 1.5em;
            color: #00d4ff;
        }

        .session-info {
            display: flex;
            gap: 20px;
            align-items: center;
        }

        .page { display: none; }
        .page.active { display: block; }

        .hero {
            text-align: center;
            padding: 60px 20px;
            background: linear-gradient(180deg, rgba(0, 212, 255, 0.1), transparent);
        }

        .hero h1 { font-size: 2.5em; margin-bottom: 20px; }
        .hero p { font-size: 1.1em; margin-bottom: 40px; color: #ccc; }

        .hero-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            max-width: 600px;
            margin: 0 auto 40px;
        }

        .stat-item {
            background: rgba(0, 212, 255, 0.1);
            padding: 20px;
            border-radius: 10px;
        }

        .stat-number { display: block; font-size: 1.8em; font-weight: bold; color: #00d4ff; }
        .stat-label { display: block; font-size: 0.9em; margin-top: 10px; color: #999; }

        .cta-button {
            background: linear-gradient(45deg, #00d4ff, #0099cc);
            color: #000;
            border: none;
            padding: 15px 40px;
            font-size: 1.1em;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
        }

        .cta-button:hover { transform: scale(1.05); }

        .section {
            max-width: 1200px;
            margin: 0 auto;
            padding: 60px 20px;
            border-bottom: 1px solid rgba(0, 212, 255, 0.1);
        }

        .section h2 { font-size: 2em; margin-bottom: 40px; text-align: center; }

        .registration-form {
            max-width: 400px;
            margin: 0 auto;
            background: rgba(30, 30, 50, 0.8);
            padding: 30px;
            border-radius: 10px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #00d4ff;
        }

        .form-group input {
            width: 100%;
            padding: 10px;
            border: 1px solid #00d4ff;
            background: rgba(0, 0, 0, 0.3);
            color: #fff;
            border-radius: 5px;
        }

        .submit-button {
            width: 100%;
            padding: 12px;
            background: linear-gradient(45deg, #8a2be2, #5a0a92);
            color: #fff;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
        }

        .features-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 30px;
        }

        .feature-card {
            background: rgba(30, 30, 50, 0.6);
            padding: 30px;
            border-radius: 10px;
            text-align: center;
        }

        .feature-icon { font-size: 3em; margin-bottom: 15px; }
        .feature-card h3 { margin-bottom: 10px; }

        .testimonials {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
        }

        .testimonial {
            background: rgba(30, 30, 50, 0.6);
            padding: 20px;
            border-left: 3px solid #00d4ff;
            border-radius: 5px;
        }

        .testimonial-author { display: block; margin-top: 15px; color: #00d4ff; font-weight: bold; }

        .lobby-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 40px 20px;
        }

        .lobby-actions {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            justify-content: center;
        }

        .btn-primary {
            background: linear-gradient(45deg, #00d4ff, #0099cc);
            color: #000;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
        }

        .btn-secondary {
            background: linear-gradient(45deg, #8a2be2, #5a0a92);
            color: #fff;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
        }

        .rooms-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
        }

        .room-card {
            background: rgba(30, 30, 50, 0.8);
            border: 2px solid #00d4ff;
            padding: 20px;
            border-radius: 10px;
        }

        .room-card h3 { color: #00d4ff; margin-bottom: 10px; }
        .room-card p { margin: 5px 0; color: #999; }

        .loading, .no-rooms, .error {
            text-align: center;
            padding: 40px;
            color: #999;
        }

        .dashboard-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 40px 20px;
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: rgba(30, 30, 50, 0.8);
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }

        .stat-value { font-size: 2em; font-weight: bold; color: #00d4ff; }
        .stat-label { color: #999; margin-top: 10px; }

        @media (max-width: 768px) {
            .hero h1 { font-size: 1.8em; }
            .hero-stats { grid-template-columns: 1fr; }
            .features-grid { grid-template-columns: 1fr; }
            .testimonials { grid-template-columns: 1fr; }
            .dashboard-grid { grid-template-columns: repeat(2, 1fr); }
        }
    </style>
</body>
</html>